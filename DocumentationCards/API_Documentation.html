<style>
  #APIframe {
    height: 100%;
    width: 100%;
    margin: 0;
    padding: 0;
    border-radius: 15px;
    border: 0;
    display: none;
    animation: fadeIn 400ms;
  }

  #DocsContent {
    overflow-y: hidden;
  }
</style>

<iframe
  id="APIframe"
  src="APIdocs/api/Quokka.html"></iframe>

<script>
  //used to detect iframe url change - run callback before iframe loads new doc
  function iframeURLChange(iframe, callback) {
    var unloadHandler = function () {
      // Timeout needed because the URL changes immediately after
      // the `unload` event is dispatched.
      setTimeout(function () {
        callback(iframe, iframe.contentWindow.location.href);
      }, 0);
    };

    function attachUnload() {
      // Remove the unloadHandler in case it was already attached.
      // Otherwise, the change will be dispatched twice.
      iframe.contentWindow.removeEventListener("unload", unloadHandler);
      iframe.contentWindow.addEventListener("unload", unloadHandler);
    }

    iframe.addEventListener("load", attachUnload);
    attachUnload();
  }

  //hide the iframe when the url changes since the theme needs to be applied (prevents flashing of white bg when in dark mode)
  iframeURLChange(document.getElementById("APIframe"), function (iframe, url) {
    $("#APIframe").css("display", "none");
  });

  //applying the right theme to the doc in the iframe and showing the frame
  function applyThemeToAPIFrame() {
    //applying light/dark theme
    if (colorScheme === "light") {
      $("#APIframe")[0].contentDocument.getElementsByTagName(
        "html"
      )[0].dataset.bsTheme = "light";
      //cursor styles
      $("#APIframe")[0].contentDocument.body.style.cursor =
        "url(../../Resources/LightPoint.cur),auto";

      for (var a of $("#APIframe")[0].contentDocument.body.getElementsByTagName(
        "a"
      )) {
        a.style.cursor = "url(../../Resources/LightClick.cur),auto";
      }
    } else {
      $("#APIframe")[0].contentDocument.getElementsByTagName(
        "html"
      )[0].dataset.bsTheme = "dark";
      //cursor styles
      $("#APIframe")[0].contentDocument.body.style.cursor =
        "url(../../Resources/DarkPoint.cur),auto";

      for (var a of $("#APIframe")[0].contentDocument.body.getElementsByTagName(
        "a"
      )) {
        a.style.cursor = "url(../../Resources/DarkClick.cur),auto";
      }
    }
    //applying primary color
    var hue = getComputedStyle(
      document.querySelector(":root")
    ).getPropertyValue("--hue");
    $("#APIframe")[0].contentDocument.body.style.setProperty(
      "--bs-link-color-rgb",
      culori
        .formatRgb("oklch(0.7 0.2 " + hue)
        .replace("rgb(", "")
        .replace(")", "")
    );

    //showing frame
    $("#APIframe").css("display", "block");
  }

  //when the iframe has loaded the doc, apply theme and show it
  document
    .getElementById("APIframe")
    .addEventListener("load", applyThemeToAPIFrame);

  //when user switches page theme, change theme of doc in iframe as well
  document
    .getElementsByClassName("switch__input")[0]
    .removeEventListener("click", applyThemeToAPIFrame);
  document
    .getElementsByClassName("switch__input")[0]
    .addEventListener("click", applyThemeToAPIFrame);
  //when user switches page color, change color of doc in iframe as well
  document
    .getElementsByClassName("slider__input")[0]
    .removeEventListener("click", applyThemeToAPIFrame);
  document
    .getElementsByClassName("slider__input")[0]
    .addEventListener("click", applyThemeToAPIFrame);
</script>
